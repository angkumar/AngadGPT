<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AngadGPT</title>
</head>
<body>
    <h1>AngadGPT</h1>
    <div>
        <label>API Key:</label>
        <input type="password" id="apiKeyInput" placeholder="Enter API key">
    </div>

    <div id="chatContainer">
        <p id="emptyState">Start a conversation by typing a message below.</p>
    </div>

    <textarea id="messageInput" placeholder="Message AngadGPT..."></textarea>
    <button id="sendButton">Send</button>

    <script>
        const API_URL = 'http://127.0.0.1:8000/generate';
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const emptyState = document.getElementById('emptyState');

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert('Please enter an API key');
                return;
            }

            if (emptyState) emptyState.style.display = 'none';

            addMessage('user', message);
            messageInput.value = '';
            sendButton.disabled = true;

            const loadingId = addMessage('assistant', '...');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: message, api_key: apiKey })
                });

                if (!response.ok) throw new Error(`HTTP error ${response.status}`);
                const data = await response.json();
                document.getElementById(loadingId).textContent = data.generated_text || 'No response.';
            } catch (error) {
                document.getElementById(loadingId).textContent = 'Error: ' + error.message;
            } finally {
                sendButton.disabled = false;
            }
        }

        function addMessage(role, content) {
            const id = 'msg-' + Date.now();
            const p = document.createElement('p');
            p.id = id;
            p.textContent = role + ': ' + content;
            chatContainer.appendChild(p);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return id;
        }
    </script>
</body>
</html>